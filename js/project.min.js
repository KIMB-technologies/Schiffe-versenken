var global_game=!1,global_spielid=0;function randomint(a,b){return Math.floor(Math.random()*(b+1-a)+a)}function set_message(a){$("div.outputs").html(" "+a);$("div.outputs").typewriter({speed:50});return!0}function show_html(a,b){$(b).html(a);return!0}function new_dialog(a,b){$("#dialog").attr("title",b);$("#dialog").html(a);$("#dialog").css("display","block");$("#dialog").dialog({width:600});$("#dialog").dialog("option","title",b)}
function close_dialog(){$("#dialog").dialog("close");$("#dialog").css("display","none")}
function reload_data(a){console.log(a);"shoot"==a?global_game||aktuser==schiffe_one.username&&pc_shoot_and_refresh():"alle_versenkt"==a?(set_message("Das Spiel ist aus!"),aktuser==schiffe_one.username?new_dialog("Du hast gewonnen!","Herzlichen Gl\u00fcckwunsch"):new_dialog("Dein Gegner hat gewonnen!","Schade"),show_html('<div style="height:334px;"><br /><br /><br /><center><a href=""><button>Neues Spiel</button></center></a></div>',"div.area_one"),show_html("","div.area_two")):"versenkt"==a&&(aktuser==
schiffe_one.username?set_message("Du hast ein Schiff versenkt!"):set_message("Eines deiner Schiff wurde versenkt!"));return!0}
function Feld(){this.max_x=9;this.max_y=11;this.koordtoletter={0:"A",1:"B",2:"C",3:"D",4:"E",5:"F",6:"G",7:"H",8:"I",9:"J",10:"K",11:"L"};this.empty_field=function(a){a='<div class="splf '+a+'"><div class="y">';a+='<div class="x">&nbsp;</div>';for(var b=0;b<=this.max_x;b++)a+='<div class="x x_'+b+'">'+b+"</div>";a+="</div>";for(b=0;b<=this.max_y;b++){a+='<div class="y y_'+b+'">';a+='<div class="x" title="'+b+'">'+this.koordtoletter[b]+"</div>";for(var e=0;e<=this.max_x;e++)a+='<div class="x y_'+b+
" x_"+e+" y_"+b+"x_"+e+'" title="'+e+" | "+this.koordtoletter[b]+" "+b+'">&nbsp;</div>';a+="</div>"}return a+="</div>"};this.show_field_shoots=function(a,b){$.each(a,function(a,c){var f;0==c.art?f="shoot_water":1==c.art?f="shoot_part":2==c.art&&(f="shoot_all");$("."+b+" div.y_"+c.y+"x_"+c.x).html('<span class="shoot '+f+'">&nbsp;</span>')});return!0};this.show_field_ships=function(a,b){var e=!1;$.each(a,function(a,f){var p=f.size;$.each(f.place,function(a,c){for(var f=c.x,g=c.y,d=c.d,k=c.t,h,l,q,
r,m=0;m<p;m++)"h"==d?(h=f+m,l=g):(h=f,l=g+m),q=0==m?"ship_bug":m==p-1?"ship_end":"ship_all",r=0==k[m]?"ship_black":"ship_red",$("."+b+" div.y_"+l+"x_"+h).html('<span class="ship '+q+"_"+d+" "+r+'">&nbsp;</span>');e=!0})});return e};this.make_shootable=function(a,b){$("."+a+" .x").click(function(){var a=$(this).attr("class").split(/\s+/),c=a[1].substr(2),a=a[2].substr(2);b.shoot_ships(a,c)});return!0}}
function Schiffe(a){"undefined"===typeof a&&(a="Max Muster");this.username=a;this.current=this.all=a={s:{name:"Schlachtschiff",size:5,anzahl:1,place:[]},k:{name:"Kreuzer",size:4,anzahl:2,place:[]},z:{name:"Zerst\u00f6rer",size:3,anzahl:3,place:[]},u:{name:"U-Boote",size:2,anzahl:4,place:[]}};this.shoots=[];this.place_random=function(){var a=this.all,e=this,c=new Feld,f=c.max_x,p=c.max_y,n=[];$.each(this.all,function(c,v){var g=v.size,d=v.anzahl;a[c].place=[];for(var k=[],h=0;h<g;h++)k.push(0);for(var l,
q,r,m,t,s,w=0;w<d;w++){l={};1==randomint(0,1)?l.d="h":l.d="v";l.t=k;"h"==l.d?(r=f-g,q=p):(r=f,q=p-g);do for(m=randomint(0,r),t=randomint(0,q),s=[],s.push(m+"-"+t),h=0;h<g;h++)"h"==l.d?s.push(m+h+"-"+t):s.push(m+"-"+(t+h));while(e.all_places_free(s,n));l.x=m;l.y=t;n=n.concat(s);a[c].place.push(l)}});this.current=a;return!0};this.all_places_free=function(a,e){var c=!1;$.each(a,function(a,b){-1!=$.inArray(b,e)&&(c=!0)});return c};this.shoot_ships=function(a,e){var c=0,f=this;$.each(this.current,function(p,
n){var u=n.size;$.each(n.place,function(n,g){var d,k,h=[];if("h"==g.d){if(g.y==e)for(k=0;k<u;k++)if(d=g.x+k,d=d.toString(),d==a){c=1;for(d=0;d<u;d++)d==k?h.push(1):h.push(g.t[d]);g.t=h;-1==$.inArray(0,g.t)&&(c=2);return f.setretval_for_shoot_ships(c,a,e)}}else if(g.x==a)for(k=0;k<u;k++)if(d=g.y+k,d=d.toString(),d==e){c=1;for(d=0;d<u;d++)d==k?h.push(1):h.push(g.t[d]);g.t=h;-1==$.inArray(0,g.t)&&(c=2);return f.setretval_for_shoot_ships(c,a,e)}})});if(0==c)return this.setretval_for_shoot_ships(c,a,e)};
this.setretval_for_shoot_ships=function(a,e,c){this.shoots.push({x:e,y:c,art:a});var f=[];$.each(this.current,function(a,b){$.each(b.place,function(a,b){-1==$.inArray(0,b.t)?f.push(!1):f.push(!0)})});e=-1==$.inArray(!0,f)?!0:!1;reload_data("shoot");2==a&&(reload_data("versenkt"),e&&reload_data("alle_versenkt"));return a}}$(function(){start_game()});var schiffe_one,schiffe_two,feld;
function start_game(){set_message('Herzlich Willkommen bei "Schiffe-versenken" von KIMB-technologies!');feld=new Feld;var a;a='<br /><span class="untertitel">Meine Schiffe</span><span class="untertitel">Schussfeld</span><br />'+feld.empty_field("my_ships");a+=feld.empty_field("shoot_at");show_html(a,"div.area_one");a=' Willkommen bei "Schiffe-versenken" von KIMB-technologies!<br />Bitte w\u00e4hlen Sie einen Gegner:<br /><br /><div id="radio"> <input type="radio" id="pc" name="pc"><label for="pc" >Computer</label><input type="radio" id="www" name="www" ><label for="www">Anderer Spieler</label></div>';
new_dialog(a,"Spielbeginn");$("#radio").buttonset();$("#radio input[type=radio]").click(function(){"pc"==$(this).attr("name")?game_contra_pc():game_contra_www()})}
function game_contra_pc(){close_dialog();schiffe_one=new Schiffe("Spieler");schiffe_two=new Schiffe("Computer");schiffe_one.place_random();schiffe_two.place_random();feld.show_field_shoots(schiffe_two.shoots,"shoot_at");feld.show_field_ships(schiffe_one.current,"my_ships");feld.make_shootable("shoot_at",schiffe_two);set_message("Die Schiffe wurden gesetzt! F\u00fchren Sie den ersten Schuss im Feld rechts aus!!");aktuser=schiffe_one.username}
function game_contra_www(){global_game=!0;new_dialog("Leider ist diese Funktion noch nicht verf\u00fcgbar","Fehler")}var pc_shoots=[],aktuser;
function pc_shoot_and_refresh(){aktuser=schiffe_two.username;var a,b;do a=randomint(0,feld.max_x),b=randomint(0,feld.max_y);while(-1!=$.inArray(a+"-"+b,pc_shoots));schiffe_one.shoot_ships(a,b);pc_shoots.push(a+"-"+b);aktuser=schiffe_one.username;feld.show_field_shoots(schiffe_two.shoots,"shoot_at");feld.show_field_ships(schiffe_one.current,"my_ships");show_enemy_field&&(feld.show_field_shoots(schiffe_one.shoots,"shoots"),feld.show_field_ships(schiffe_two.current,"your_ships"))}
var show_enemy_field=!1;function show_enemy(a){"undefined"===typeof a?(a=feld.empty_field("your_ships"),a+=feld.empty_field("shoots"),show_html(a,"div.area_two"),show_enemy_field=!0,feld.show_field_shoots(schiffe_one.shoots,"shoots"),feld.show_field_ships(schiffe_two.current,"your_ships")):(show_html("","div.area_two"),show_enemy_field=!1);return!0}
$(function(){$("div.shoot_at .x").hover(function(){var a=$(this).attr("class").split(/\s+/);2<a.length&&($("div.shoot_at ."+a[1]).css("background-color","#aeb"),$("div.shoot_at ."+a[2]).css("background-color","#aeb"),$("div.shoot_at ."+a[3]).css("background-color","#5d7"))},function(){var a=$(this).attr("class").split(/\s+/);$("div.shoot_at ."+a[1]).css("background-color","white");$("div.shoot_at ."+a[2]).css("background-color","white");$("div.shoot_at ."+a[3]).css("background-color","white")})});
