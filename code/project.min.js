var global_game=!1,global_spielid=0;function randomint(a,h){return Math.floor(Math.random()*(h+1-a)+a)}var message_id=1;function set_message(a,h){"undefined"===typeof h?$("div.outputs").prepend('<div id="m'+message_id+'"></div>'):$("div.outputs").prepend('<div id="m'+message_id+'">'+a+"</div>");3<message_id&&$("div.outputs div#m"+(message_id-3)).css("display","none");"undefined"===typeof h&&$("div.outputs div#m"+message_id).typed({typeSpeed:0,strings:[a]});message_id++;return!0}
function show_html(a,h){$(h).html(a);return!0}function new_dialog(a,h,k){$("#dialog").attr("title",h);$("#dialog").html(a);$("#dialog").css("display","block");$("#dialog").dialog({width:600,modal:!0});$("#dialog").dialog("option","title",h);"undefined"===typeof k?$(".ui-dialog-titlebar-close").css("display","none"):$(".ui-dialog-titlebar-close").css("display","block")}function close_dialog(){$("#dialog").dialog("close");$("#dialog").css("display","none")}var all_events=[];
function reload_data(a){console.log(a);all_events.push(a);"shoot"==a?global_game||aktuser==schiffe_one.username&&pc_shoot_and_refresh():"alle_versenkt"==a?(set_message("Das Spiel ist aus!"),aktuser==schiffe_one.username?(new_dialog("Du hast gewonnen!","Herzlichen Gl\u00fcckwunsch",!0),set_message("Du hast gewonnen!"),set_message("Herzlichen Gl\u00fcckwunsch &#128515;",!1)):(new_dialog("Dein Gegner hat gewonnen!","Schade",!0),set_message("Dein Gegner hat gewonnen!"),set_message("Schade &#128542;",
!1)),show_html('<div style="height:334px;"><br /><br /><br /><center><div id="button_new">Neues Spiel</div></center></a></div>',"div.area_one"),$("#button_new").button(),$("#button_new").click(function(){start_game()}),show_html("","div.ship_stat"),show_html("","div.area_two")):"versenkt"==a&&(aktuser==schiffe_one.username?set_message("Du hast ein Schiff versenkt! (Gegner hat noch "+schiffe_two.number_of_ships+"/10)"):set_message("Eines deiner Schiff wurde versenkt! (Du hast noch "+schiffe_one.number_of_ships+
"/10)"));return!0}
function hover_shoot_at(){$("div.shoot_at .x").hover(function(){var a=$(this).attr("class").split(/\s+/);2<a.length&&($("div.shoot_at ."+a[1]).css("background-color","#aeb"),$("div.shoot_at ."+a[2]).css("background-color","#aeb"),$("div.shoot_at ."+a[3]).css("background-color","#5d7"))},function(){var a=$(this).attr("class").split(/\s+/);$("div.shoot_at ."+a[1]).css("background-color","white");$("div.shoot_at ."+a[2]).css("background-color","white");$("div.shoot_at ."+a[3]).css("background-color","white")});
return!0}
function Feld(){this.max_x=9;this.max_y=11;this.koordtoletter={0:"A",1:"B",2:"C",3:"D",4:"E",5:"F",6:"G",7:"H",8:"I",9:"J",10:"K",11:"L"};this.empty_field=function(a){a='<div class="splf '+a+'"><div class="y">';a+='<div class="x">&nbsp;</div>';for(var h=0;h<=this.max_x;h++)a+='<div class="x x_'+h+'">'+h+"</div>";a+="</div>";for(h=0;h<=this.max_y;h++){a+='<div class="y y_'+h+'">';a+='<div class="x" title="'+h+'">'+this.koordtoletter[h]+"</div>";for(var k=0;k<=this.max_x;k++)a+='<div class="x y_'+h+
" x_"+k+" y_"+h+"x_"+k+'" title="'+k+" | "+this.koordtoletter[h]+" "+h+'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>';a+="</div>"}return a+="</div>"};this.show_field_shoots=function(a,h){$.each(a,function(a,e){var b;0==e.art?b="shoot_water":1==e.art?b="shoot_part":2==e.art&&(b="shoot_all");$("."+h+" div.y_"+e.y+"x_"+e.x).html('<span class="shoot '+b+'">&nbsp;</span>')});return!0};this.show_field_ships=function(a,h){var k=!1;$.each(a,function(e,b){var a=b.size;$.each(b.place,function(e,b){for(var q=b.x,
v=b.y,g=b.d,l=b.t,m,n,r,w,u=0;u<a;u++)"h"==g?(m=q+u,n=v):(m=q,n=v+u),r=0==u?"ship_bug":u==a-1?"ship_end":"ship_all",w=0==l[u]?"ship_black":"ship_red",$("."+h+" div.y_"+n+"x_"+m).html('<span class="ship '+r+"_"+g+" "+w+'">&nbsp;</span>');k=!0})});return k};this.make_shootable=function(a,h){$("."+a+" .x").click(function(){var a=$(this).attr("class").split(/\s+/),e=a[1].substr(2),a=a[2].substr(2);h.shoot_ships(a,e)});return!0};this.show_shipnumbers=function(a,h,k){var e;e='<b>Schiffe</b><br /><div id="one"><div class="label"></div></div><div id="two"><div class="label"></div></div>';
show_html(e,"div."+a);$("div."+a+" #one").progressbar({value:h.number_of_ships,max:10});$("div."+a+" #one .label").text("Spieler: "+h.number_of_ships+"/10");$("div."+a+" #two").progressbar({value:k.number_of_ships,max:10});$("div."+a+" #two .label").text("Gegner: "+k.number_of_ships+"/10");return!0}}
function Schiffe(a){"undefined"===typeof a&&(a="Max Muster");this.username=a;this.current=this.all=a={s:{name:"Schlachtschiff",size:5,anzahl:1,place:[]},k:{name:"Kreuzer",size:4,anzahl:2,place:[]},z:{name:"Zerst\u00f6rer",size:3,anzahl:3,place:[]},u:{name:"U-Boote",size:2,anzahl:4,place:[]}};this.number_of_ships=10;this.shoots=[];this.replace_ship_allow=!0;this.place_random=function(){var a=this.all,k=this,e=new Feld,b=e.max_x,c=e.max_y,f=[],p;$.each(this.all,function(e,v){var g=v.size,l=v.anzahl;
a[e].place=[];for(var m=[],n=0;n<g;n++)m.push(0);for(var r,w,u,s,t,x,y=0;y<l;y++){r={};1==randomint(0,1)?r.d="h":r.d="v";r.t=m;"h"==r.d?(u=b-g,w=c):(u=b,w=c-g);p=0;do{s=randomint(0,u);t=randomint(0,w);x=[];x.push(s+"-"+t);for(n=0;n<g;n++)"h"==r.d?x.push(s+n+"-"+t):x.push(s+"-"+(t+n));if(500<p){sessionStorage.setItem("abbruch","zvv");location.reload();return}p++}while(k.all_places_free(x,f));r.x=s;r.y=t;for(n=-1;n<g+1;n++)"h"==r.d?(0<=c-t&&f.push(s+n+"-"+(t+1)),0<=t-1&&f.push(s+n+"-"+(t-1))):(0<=b-
s&&f.push(s+1+"-"+(t+n)),0<=s-1&&f.push(s-1+"-"+(t+n)));"h"==r.d?f.push(s-1+"-"+t):f.push(s+"-"+(t-1));"h"==r.d?f.push(s+g+"-"+t):f.push(s+"-"+(t+g));f=f.concat(x);a[e].place.push(r)}});this.current=a;return!0};this.replace_allow=function(a,k){var e=this;if(this.replace_ship_allow){var b;b='<hr /><div class="lagebar"><b>Lage anpassen<b/><br /><span class="ui-icon ui-icon-scissors" style="display:inline-block;" title="Schiffe verschieben aktivieren"></span>';b+='<span class="ui-icon ui-icon-arrowreturnthick-1-w" style="display:inline-block;" title="Ausrichtung des Schiffes \u00e4ndern"></span>&nbsp;&nbsp;&nbsp;&nbsp;';
b+='<span class="ui-icon ui-icon-info" style="display:inline-block;" title="Hier k\u00f6nnen Sie Ihre Schiffe verschieben. Aktivieren Sie zuerst die Funktion (Schere), anschlie\u00dfend k\u00f6nnen Sie ein Schiff mit einem Klick auf den Bug w\u00e4hlen. Die Ausrichtung dieses Schiffes k\u00f6nnen Sie mit dem Pfeil anpassen. Mit einem Klick auf einen freien Platz wird Ihr Schiff dorthin verschoben. Die Funktion wird automatisch mit dem ersten Schuss geblockt!"></span>';b+="</div><hr />";show_html(b,
"div.replace_ship");$("div.lagebar").tooltip();$("span.ui-icon-scissors").button();$("span.ui-icon-arrowreturnthick-1-w").button();var c=!1,f=1,p=1,q="h";$("div.lagebar span.ui-icon-scissors").unbind("click").click(function(){$("span.ship_black.ship_bug_v").css({"background-color":"green","border-bottom-color":"green","border-right-color":"green"});$("span.ship_black.ship_bug_h").css({"background-color":"green","border-bottom-color":"green","border-right-color":"green"});$("span.ship_bug_h").unbind("click").click(function(){var e=
$(this).parent().attr("class").split(/\s+/);c=!0;p=e[1].substr(2);f=e[2].substr(2);q="h";set_message("Sie haben ein Schiff ausgew\u00e4hlt!");$(this).css({"background-color":"blue","border-bottom-color":"blue","border-right-color":"blue"})});$("span.ship_bug_v").unbind("click").click(function(){var e=$(this).parent().attr("class").split(/\s+/);c=!0;p=e[1].substr(2);f=e[2].substr(2);q="v";set_message("Sie haben ein Schiff ausgew\u00e4hlt!");$(this).css({"background-color":"blue","border-bottom-color":"blue",
"border-right-color":"blue"})});$("div.lagebar span.ui-icon-arrowreturnthick-1-w").unbind("click").click(function(){c&&("h"==q?(q="v",set_message("Das Schiff steht nun vertikal!")):(q="h",set_message("Das Schiff steht nun horizontal!")))});$("div.my_ships .x").unbind("click").hover(function(){c&&2<$(this).attr("class").split(/\s+/).length&&$(this).css("background-color","lightblue")},function(){$(this).css("background-color","white")});$("div.my_ships .x").unbind("click").click(function(){if(c){var b=
$(this).attr("class").split(/\s+/);2<b.length&&(y_new=b[1].substr(2),x_new=b[2].substr(2),old_x=f,old_y=p,d=q,old_x!=x_new||old_y!=y_new)&&(e.replace_ship(old_x,old_y,x_new,y_new,d,a,k)?(c=!1,$("span.ship_black").css({"background-color":"black","border-bottom-color":"black","border-right-color":"black"})):set_message("Das Schiff konnte nicht verschoben werden. W\u00e4hlen Sie ggf. eine andere Stelle!"))}})})}};this.replace_ship=function(a,k,e,b,c,f,p){e=parseInt(e);b=parseInt(b);a=parseInt(a);k=parseInt(k);
if(this.replace_ship_allow){var q=[],v;$.each(this.current,function(e,b){var c=b.size;$.each(b.place,function(b,g){g.x==a&&g.y==k&&(v={klasse:e,index:b,size:c});for(var f=0;f<c;f++)"h"==g.d?q.push(g.x+f+"-"+g.y):q.push(g.x+"-"+(g.y+f))})});for(var g=p.max_x,l=p.max_y,m=0;m<v.size;m++)if("h"==c){if(-1!=$.inArray(e+m+"-"+b,q)||e+m>g||b>l)return!1}else if(-1!=$.inArray(e+"-"+(b+m),q)||e>g||b+m>l)return!1;g=v.klasse;l=v.index;this.current[g].place[l].x=e;this.current[g].place[l].y=b;this.current[g].place[l].d=
c;$(".my_ships").replaceWith(p.empty_field("my_ships"));p.show_field_ships(this.current,f);return!0}return!1};this.replace_disallow=function(){this.replace_ship_allow=!1;$("div.replace_ship").css("display","none");$("span.ship_black").css({"background-color":"black","border-bottom-color":"black","border-right-color":"black"})};this.replace_reallow=function(){this.replace_ship_allow=!0;$("div.replace_ship").css("display","block")};this.all_places_free=function(a,k){var e=!1;$.each(a,function(a,c){-1!=
$.inArray(c,k)&&(e=!0)});return e};this.shoot_ships=function(a,k){this.replace_disallow();var e=0,b=this;$.each(this.current,function(c,f){var p=f.size;$.each(f.place,function(c,f){var g,l,m=[];if("h"==f.d){if(f.y==k)for(l=0;l<p;l++)if(g=f.x+l,g=g.toString(),g==a){e=1;for(g=0;g<p;g++)g==l?m.push(1):m.push(f.t[g]);f.t=m;-1==$.inArray(0,f.t)&&(e=2);return b.setretval_for_shoot_ships(e,a,k)}}else if(f.x==a)for(l=0;l<p;l++)if(g=f.y+l,g=g.toString(),g==k){e=1;for(g=0;g<p;g++)g==l?m.push(1):m.push(f.t[g]);
f.t=m;-1==$.inArray(0,f.t)&&(e=2);return b.setretval_for_shoot_ships(e,a,k)}});return e});return 0==e?this.setretval_for_shoot_ships(e,a,k):e};this.setretval_for_shoot_ships=function(a,k,e){this.shoots.push({x:k,y:e,art:a});var b=[];this.number_of_ships=0;var c=this;$.each(this.current,function(a,e){$.each(e.place,function(a,e){-1==$.inArray(0,e.t)?b.push(!1):(b.push(!0),c.number_of_ships++)})});k=-1==$.inArray(!0,b)?!0:!1;reload_data("shoot");2==a&&(reload_data("versenkt"),k&&reload_data("alle_versenkt"));
return a}}
function KI(a,h,k){"undefined"===typeof k&&(k=1);this.level=k;this.otherdir=!1;this.shipfound_place;this.freilasskaestchen="unset";this.done_shoots=[];this.next="unset";this.shoot=function(){4==this.level?this.allwissend():2==this.level||3==this.level?this.versenken():this.random()};this.random=function(){var a=this.get_xy();this.final_shoot(a.x,a.y)};this.versenken=function(){if("unset"==this.next){var a=2==this.level?this.get_xy():this.freilassen(),b=a.x,a=a.y,c=this.final_shoot(b,a);if(1==c){var c=
randomint(0,3),f;0==c?f=[{x:b,y:a},{x:b+1,y:a},{x:b,y:a+1},{x:b-1,y:a},{x:b,y:a-1}]:1==c?f=[{x:b,y:a},{x:b-1,y:a},{x:b,y:a-1},{x:b+1,y:a},{x:b,y:a+1}]:2==c?f=[{x:b,y:a},{x:b,y:a-1},{x:b-1,y:a},{x:b,y:a+1},{x:b+1,y:a}]:3==c&&(f=[{x:b,y:a},{x:b,y:a+1},{x:b+1,y:a},{x:b,y:a-1},{x:b-1,y:a}]);var k=this;this.next=[];$.each(f,function(a,b){b.x>h.max_x||0>b.x||b.y>h.max_y||0>b.y||k.next.push(b)});this.shipfound_place={x:b,y:a}}}else if(b=this.next[1].x,a=this.next[1].y,c=this.final_shoot(b,a),0==c&&1==this.otherdir)f=
this.shipfound_place.x,c=this.shipfound_place.y,f==b?this.next=0>a-c?[{x:f,y:c},{x:f,y:c+1}]:[{x:f,y:c},{x:f,y:c-1}]:c==a?this.next=0>b-f?[{x:f,y:c},{x:f+1,y:c}]:[{x:f,y:c},{x:f-1,y:c}]:(this.next="unset",this.otherdir=!1);else if(0==c){var q=[];$.each(this.next,function(a,b){1!=a&&q.push(b)});this.next=q;"undefined"===typeof this.next[1]&&(this.next="unset");this.otherdir=!1}else 1==c?(this.otherdir=!0,a==this.next[0].y?1==this.next[0].x-b?this.next=[{x:b,y:a},{x:b-1,y:a}]:-1==this.next[0].x-b?this.next=
[{x:b,y:a},{x:b+1,y:a}]:(this.next="unset",this.otherdir=!1):b==this.next[0].x?1==this.next[0].y-a?this.next=[{x:b,y:a},{x:b,y:a-1}]:-1==this.next[0].y-a?this.next=[{x:b,y:a},{x:b,y:a+1}]:(this.next="unset",this.otherdir=!1):(this.next="unset",this.otherdir=!1)):2==c&&(this.next="unset",this.otherdir=!1)};this.freilassen=function(){if("unset"==this.freilasskaestchen){this.freilasskaestchen=[];var a,b,c;c=randomint(0,1);for(a=0;a<h.max_x+1;a++)for(c++,b=0;b<h.max_y+1;b++)0!=c%2&&this.freilasskaestchen.push({x:a,
y:b,art:0}),c++}b=this.freilasskaestchen.length;--b;do c=randomint(0,b),a=this.freilasskaestchen[c].x,c=this.freilasskaestchen[c].y;while(-1!=$.inArray(a+"-"+c,this.done_shoots));return{x:a,y:c}};this.allwissend=function(){if("unset"==this.next){var e=[];$.each(a.current,function(a,c){var f=c.size;$.each(c.place,function(a,b){for(var c=0;c<f;c++)"h"==b.d?e.push({x:b.x+c,y:b.y}):e.push({x:b.x,y:b.y+c})})});this.next=e;this.next_index=0}this.final_shoot(this.next[this.next_index].x,this.next[this.next_index].y);
this.next_index++};this.get_xy=function(){var a,b;do a=randomint(0,h.max_x),b=randomint(0,h.max_y);while(-1!=$.inArray(a+"-"+b,this.done_shoots));return{x:a,y:b}};this.final_shoot=function(e,b){this.done_shoots.push(e+"-"+b);return a.shoot_ships(e,b)}}$(function(){start_game()});var schiffe_one,schiffe_two,feld,ki,ki_level;
function start_game(){global_game=!1;set_message('Herzlich Willkommen bei "Schiffe-versenken" von KIMB-technologies!');feld=new Feld;var a;a='<br /><span class="untertitel">Meine Schiffe</span><span class="untertitel">Schussfeld</span><br />'+feld.empty_field("my_ships");a+=feld.empty_field("shoot_at");show_html(a,"div.area_one");hover_shoot_at();a=' Willkommen bei "Schiffe-versenken" von KIMB-technologies!<br />Bitte w\u00e4hlen Sie einen Gegner:<br /><br /><div id="radio"> <input type="radio" id="pc" name="pc"><label for="pc" >Computer</label><input type="radio" id="www" name="www" ><label for="www">Anderer Spieler</label></div>';
new_dialog(a,"Spielbeginn");$("#radio").buttonset();$("#radio input[type=radio]").click(function(){"pc"==$(this).attr("name")?game_contra_pc():game_contra_www()})}
function game_contra_pc(){var a;a='Bitte w\u00e4hlen Sie die St\u00e4rke des Computers:<br /><br /><div id="radio"><input type="radio" id="l1" name="l1" ><label for="l1"  title="Der Computer schie\u00dft einfach zuf\u00e4llig." >Schwach</label>';a+='<input type="radio" id="l2" name="l2" ><label for="l2" title="Der Computer schie\u00dft zuf\u00e4llig, versenkt aber gefundene Schiffe." >Mittel</label>';a+='<input type="radio" id="l3" name="l3" ><label for="l3" title="Der Computer schie\u00dft so, dass immer einzelne K\u00e4stchen frei bleiben (dort kann kein Schiff sein) und versenkt gefundene Schiffe." >Stark</label>';
a+='<input type="radio" id="l4" name="l4"><label for="l4" title="Der Computer schummelt und kennt die Schiffe des Gegners.">Extrem</label>';a+="</div>";new_dialog(a,"KI Level");$("#radio").buttonset();$("#radio").tooltip();$("#radio input[type=radio]").click(function(){ki_level="l4"==$(this).attr("name")?4:"l3"==$(this).attr("name")?3:"l2"==$(this).attr("name")?2:1;close_dialog();ki=new KI(schiffe_one,feld,ki_level)});schiffe_one=new Schiffe("Spieler");schiffe_two=new Schiffe("Computer");schiffe_one.place_random();
schiffe_two.place_random();feld.show_field_shoots(schiffe_two.shoots,"shoot_at");feld.show_field_ships(schiffe_one.current,"my_ships");feld.make_shootable("shoot_at",schiffe_two);feld.show_shipnumbers("ship_stat",schiffe_one,schiffe_two);set_message("Die Schiffe wurden gesetzt!");set_message("F\u00fchren Sie den ersten Schuss im Feld rechts aus!!");set_message("Sie k\u00f6nnen gerne Ihre Schiffe neu anordnen (Toolbar unten)!!");schiffe_one.replace_reallow();schiffe_one.replace_allow("my_ships",feld);
aktuser=schiffe_one.username}function game_contra_www(){global_game=!0;new_dialog('Leider ist diese Funktion noch nicht verf\u00fcgbar!<br /><br /><center><div id="button" >OK</div></center>',"Fehler");$("#button").button();$("#button").click(function(){start_game()})}var aktuser;
function pc_shoot_and_refresh(){aktuser=schiffe_two.username;ki.shoot();aktuser=schiffe_one.username;feld.show_field_shoots(schiffe_two.shoots,"shoot_at");feld.show_field_ships(schiffe_one.current,"my_ships");-1==$.inArray("alle_versenkt",all_events)&&(feld.show_shipnumbers("ship_stat",schiffe_one,schiffe_two),show_enemy_field&&(feld.show_field_shoots(schiffe_one.shoots,"shoots"),feld.show_field_ships(schiffe_two.current,"your_ships")))}var show_enemy_field=!1;
function show_enemy(a){"undefined"===typeof a?(a=feld.empty_field("your_ships"),a+=feld.empty_field("shoots"),show_html(a,"div.area_two"),show_enemy_field=!0,feld.show_field_shoots(schiffe_one.shoots,"shoots"),feld.show_field_ships(schiffe_two.current,"your_ships")):(show_html("","div.area_two"),show_enemy_field=!1);return!0}
$(function(){null!=sessionStorage.getItem("abbruch")&&($("body").append('<div id="error-message">Die Seite wurde aufgrund eines Fehler neu geladen!<br /><br /><b>Informationen:</b><br /><i>'+sessionStorage.getItem("abbruch")+"</i></div>"),$("#error-message").dialog({modal:!0,title:"Fehler",resizable:!1,buttons:{Ok:function(){$(this).dialog("close")}}}),$(".ui-dialog-titlebar-close").css("display","none"),sessionStorage.removeItem("abbruch"))});
