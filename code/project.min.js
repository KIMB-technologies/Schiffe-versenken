var global_game=!1,global_spielid=0;function randomint(a,f){return Math.floor(Math.random()*(f+1-a)+a)}var message_id=1;function set_message(a,f){"undefined"===typeof f?$("div.outputs").prepend('<div id="m'+message_id+'"></div>'):$("div.outputs").prepend('<div id="m'+message_id+'">'+a+"</div>");3<message_id&&$("div.outputs div#m"+(message_id-3)).css("display","none");"undefined"===typeof f&&$("div.outputs div#m"+message_id).typed({typeSpeed:0,strings:[a]});message_id++;return!0}
function show_html(a,f){$(f).html(a);return!0}function new_dialog(a,f){$("#dialog").attr("title",f);$("#dialog").html(a);$("#dialog").css("display","block");$("#dialog").dialog({width:600});$("#dialog").dialog("option","title",f)}function close_dialog(){$("#dialog").dialog("close");$("#dialog").css("display","none")}
function reload_data(a){console.log(a);"shoot"==a?global_game||aktuser==schiffe_one.username&&pc_shoot_and_refresh():"alle_versenkt"==a?(set_message("Das Spiel ist aus!"),aktuser==schiffe_one.username?(new_dialog("Du hast gewonnen!","Herzlichen Gl\u00fcckwunsch"),set_message("Du hast gewonnen!"),set_message("Herzlichen Gl\u00fcckwunsch &#128515;",!1)):(new_dialog("Dein Gegner hat gewonnen!","Schade"),set_message("Dein Gegner hat gewonnen!"),set_message("Schade &#128542;",!1)),show_html('<div style="height:334px;"><br /><br /><br /><center><div id="button_new">Neues Spiel</div></center></a></div>',
"div.area_one"),$("#button_new").button(),$("#button_new").click(function(){start_game()}),show_html("","div.ship_stat"),show_html("","div.area_two")):"versenkt"==a&&(aktuser==schiffe_one.username?set_message("Du hast ein Schiff versenkt! (Gegner hat noch "+schiffe_two.number_of_ships+"/10)"):set_message("Eines deiner Schiff wurde versenkt! (Du hast noch "+schiffe_one.number_of_ships+"/10)"));return!0}
function Feld(){this.max_x=9;this.max_y=11;this.koordtoletter={0:"A",1:"B",2:"C",3:"D",4:"E",5:"F",6:"G",7:"H",8:"I",9:"J",10:"K",11:"L"};this.empty_field=function(a){a='<div class="splf '+a+'"><div class="y">';a+='<div class="x">&nbsp;</div>';for(var f=0;f<=this.max_x;f++)a+='<div class="x x_'+f+'">'+f+"</div>";a+="</div>";for(f=0;f<=this.max_y;f++){a+='<div class="y y_'+f+'">';a+='<div class="x" title="'+f+'">'+this.koordtoletter[f]+"</div>";for(var g=0;g<=this.max_x;g++)a+='<div class="x y_'+f+
" x_"+g+" y_"+f+"x_"+g+'" title="'+g+" | "+this.koordtoletter[f]+" "+f+'">&nbsp;</div>';a+="</div>"}return a+="</div>"};this.show_field_shoots=function(a,f){$.each(a,function(a,d){var b;0==d.art?b="shoot_water":1==d.art?b="shoot_part":2==d.art&&(b="shoot_all");$("."+f+" div.y_"+d.y+"x_"+d.x).html('<span class="shoot '+b+'">&nbsp;</span>')});return!0};this.show_field_ships=function(a,f){var g=!1;$.each(a,function(d,a){var c=a.size;$.each(a.place,function(d,a){for(var b=a.x,q=a.y,k=a.d,n=a.t,h,m,r,
s,l=0;l<c;l++)"h"==k?(h=b+l,m=q):(h=b,m=q+l),r=0==l?"ship_bug":l==c-1?"ship_end":"ship_all",s=0==n[l]?"ship_black":"ship_red",$("."+f+" div.y_"+m+"x_"+h).html('<span class="ship '+r+"_"+k+" "+s+'">&nbsp;</span>');g=!0})});return g};this.make_shootable=function(a,f){$("."+a+" .x").click(function(){var a=$(this).attr("class").split(/\s+/),d=a[1].substr(2),a=a[2].substr(2);f.shoot_ships(a,d)});return!0};this.show_shipnumbers=function(a,f,g){var d;d='<b>Schiffe</b><br /><div id="one"><div class="label"></div></div><div id="two"><div class="label"></div></div>';
show_html(d,"div."+a);$("div."+a+" #one").progressbar({value:f.number_of_ships,max:10});$("div."+a+" #one .label").text("Spieler: "+f.number_of_ships+"/10");$("div."+a+" #two").progressbar({value:g.number_of_ships,max:10});$("div."+a+" #two .label").text("Gegner: "+g.number_of_ships+"/10");return!0}}
function Schiffe(a){"undefined"===typeof a&&(a="Max Muster");this.username=a;this.current=this.all=a={s:{name:"Schlachtschiff",size:5,anzahl:1,place:[]},k:{name:"Kreuzer",size:4,anzahl:2,place:[]},z:{name:"Zerst\u00f6rer",size:3,anzahl:3,place:[]},u:{name:"U-Boote",size:2,anzahl:4,place:[]}};this.number_of_ships=10;this.shoots=[];this.place_random=function(){var a=this.all,g=this,d=new Feld,b=d.max_x,c=d.max_y,e=[];$.each(this.all,function(d,u){var q=u.size,k=u.anzahl;a[d].place=[];for(var n=[],h=
0;h<q;h++)n.push(0);for(var m,r,s,l,p,t,w=0;w<k;w++){m={};1==randomint(0,1)?m.d="h":m.d="v";m.t=n;"h"==m.d?(s=b-q,r=c):(s=b,r=c-q);do for(l=randomint(0,s),p=randomint(0,r),t=[],t.push(l+"-"+p),h=0;h<q;h++)"h"==m.d?t.push(l+h+"-"+p):t.push(l+"-"+(p+h));while(g.all_places_free(t,e));m.x=l;m.y=p;for(h=-1;h<q+1;h++)"h"==m.d?(0<=c-p&&e.push(l+h+"-"+(p+1)),0<=p-1&&e.push(l+h+"-"+(p-1))):(0<=b-l&&e.push(l+1+"-"+(p+h)),0<=l-1&&e.push(l-1+"-"+(p+h)));"h"==m.d?e.push(l-1+"-"+p):e.push(l+"-"+(p-1));"h"==m.d?
e.push(l+q+"-"+p):e.push(l+"-"+(p+q));e=e.concat(t);a[d].place.push(m)}});this.current=a;return!0};this.all_places_free=function(a,g){var d=!1;$.each(a,function(a,f){-1!=$.inArray(f,g)&&(d=!0)});return d};this.shoot_ships=function(a,g){var d=0,b=this;$.each(this.current,function(c,e){var v=e.size;$.each(e.place,function(c,e){var k,n,h=[];if("h"==e.d){if(e.y==g)for(n=0;n<v;n++)if(k=e.x+n,k=k.toString(),k==a){d=1;for(k=0;k<v;k++)k==n?h.push(1):h.push(e.t[k]);e.t=h;-1==$.inArray(0,e.t)&&(d=2);return b.setretval_for_shoot_ships(d,
a,g)}}else if(e.x==a)for(n=0;n<v;n++)if(k=e.y+n,k=k.toString(),k==g){d=1;for(k=0;k<v;k++)k==n?h.push(1):h.push(e.t[k]);e.t=h;-1==$.inArray(0,e.t)&&(d=2);return b.setretval_for_shoot_ships(d,a,g)}});return d});return 0==d?this.setretval_for_shoot_ships(d,a,g):d};this.setretval_for_shoot_ships=function(a,g,d){this.shoots.push({x:g,y:d,art:a});var b=[];this.number_of_ships=0;var c=this;$.each(this.current,function(a,d){$.each(d.place,function(a,d){-1==$.inArray(0,d.t)?b.push(!1):(b.push(!0),c.number_of_ships++)})});
g=-1==$.inArray(!0,b)?!0:!1;reload_data("shoot");2==a&&(reload_data("versenkt"),g&&reload_data("alle_versenkt"));return a}}
function KI(a,f,g){"undefined"===typeof g&&(g=1);this.level=g;this.otherdir=!1;this.shipfound_place;this.freilasskaestchen="unset";this.done_shoots=[];this.next="unset";this.shoot=function(){4==this.level?this.allwissend():2==this.level||3==this.level?this.versenken():this.random()};this.random=function(){var a=this.get_xy();this.final_shoot(a.x,a.y)};this.versenken=function(){if("unset"==this.next){var a=2==this.level?this.get_xy():this.freilassen(),b=a.x,a=a.y,c=this.final_shoot(b,a);if(1==c){var c=
randomint(0,3),e;0==c?e=[{x:b,y:a},{x:b+1,y:a},{x:b,y:a+1},{x:b-1,y:a},{x:b,y:a-1}]:1==c?e=[{x:b,y:a},{x:b-1,y:a},{x:b,y:a-1},{x:b+1,y:a},{x:b,y:a+1}]:2==c?e=[{x:b,y:a},{x:b,y:a-1},{x:b-1,y:a},{x:b,y:a+1},{x:b+1,y:a}]:3==c&&(e=[{x:b,y:a},{x:b,y:a+1},{x:b+1,y:a},{x:b,y:a-1},{x:b-1,y:a}]);var g=this;this.next=[];$.each(e,function(a,b){b.x>f.max_x||0>b.x||b.y>f.max_y||0>b.y||g.next.push(b)});this.shipfound_place={x:b,y:a}}}else if(b=this.next[1].x,a=this.next[1].y,c=this.final_shoot(b,a),0==c&&1==this.otherdir)e=
this.shipfound_place.x,c=this.shipfound_place.y,e==b?this.next=0>a-c?[{x:e,y:c},{x:e,y:c+1}]:[{x:e,y:c},{x:e,y:c-1}]:c==a?this.next=0>b-e?[{x:e,y:c},{x:e+1,y:c}]:[{x:e,y:c},{x:e-1,y:c}]:(this.next="unset",this.otherdir=!1);else if(0==c){var u=[];$.each(this.next,function(a,b){1!=a&&u.push(b)});this.next=u;"undefined"===typeof this.next[1]&&(this.next="unset");this.otherdir=!1}else 1==c?(this.otherdir=!0,a==this.next[0].y?1==this.next[0].x-b?this.next=[{x:b,y:a},{x:b-1,y:a}]:-1==this.next[0].x-b?this.next=
[{x:b,y:a},{x:b+1,y:a}]:(this.next="unset",this.otherdir=!1):b==this.next[0].x?1==this.next[0].y-a?this.next=[{x:b,y:a},{x:b,y:a-1}]:-1==this.next[0].y-a?this.next=[{x:b,y:a},{x:b,y:a+1}]:(this.next="unset",this.otherdir=!1):(this.next="unset",this.otherdir=!1)):2==c&&(this.next="unset",this.otherdir=!1)};this.freilassen=function(){if("unset"==this.freilasskaestchen){this.freilasskaestchen=[];var a,b,c;c=randomint(0,1);for(a=0;a<f.max_x+1;a++)for(c++,b=0;b<f.max_y+1;b++)0!=c%2&&this.freilasskaestchen.push({x:a,
y:b,art:0}),c++}b=this.freilasskaestchen.length;--b;do c=randomint(0,b),a=this.freilasskaestchen[c].x,c=this.freilasskaestchen[c].y;while(-1!=$.inArray(a+"-"+c,this.done_shoots));return{x:a,y:c}};this.allwissend=function(){if("unset"==this.next){var d=[];$.each(a.current,function(a,c){var e=c.size;$.each(c.place,function(a,b){for(var c=0;c<e;c++)"h"==b.d?d.push({x:b.x+c,y:b.y}):d.push({x:b.x,y:b.y+c})})});this.next=d;this.next_index=0}this.final_shoot(this.next[this.next_index].x,this.next[this.next_index].y);
this.next_index++};this.get_xy=function(){var a,b;do a=randomint(0,f.max_x),b=randomint(0,f.max_y);while(-1!=$.inArray(a+"-"+b,this.done_shoots));return{x:a,y:b}};this.final_shoot=function(d,b){this.done_shoots.push(d+"-"+b);return a.shoot_ships(d,b)}}$(function(){start_game()});var schiffe_one,schiffe_two,feld,ki,ki_level;
function start_game(){global_game=!1;set_message('Herzlich Willkommen bei "Schiffe-versenken" von KIMB-technologies!');feld=new Feld;var a;a='<br /><span class="untertitel">Meine Schiffe</span><span class="untertitel">Schussfeld</span><br />'+feld.empty_field("my_ships");a+=feld.empty_field("shoot_at");show_html(a,"div.area_one");a=' Willkommen bei "Schiffe-versenken" von KIMB-technologies!<br />Bitte w\u00e4hlen Sie einen Gegner:<br /><br /><div id="radio"> <input type="radio" id="pc" name="pc"><label for="pc" >Computer</label><input type="radio" id="www" name="www" ><label for="www">Anderer Spieler</label></div>';
new_dialog(a,"Spielbeginn");$("#radio").buttonset();$("#radio input[type=radio]").click(function(){"pc"==$(this).attr("name")?game_contra_pc():game_contra_www()})}
function game_contra_pc(){var a;a='Bitte w\u00e4hlen Sie die St\u00e4rke des Computers:<br /><br /><div id="radio"><input type="radio" id="l1" name="l1" ><label for="l1"  title="Der Computer schie\u00dft einfach zuf\u00e4llig." >Schwach</label>';a+='<input type="radio" id="l2" name="l2" ><label for="l2" title="Der Computer schie\u00dft zuf\u00e4llig, versenkt aber gefundene Schiffe." >Mittel</label>';a+='<input type="radio" id="l3" name="l3" ><label for="l3" title="Der Computer schie\u00dft so, dass immer einzelne K\u00e4stchen frei bleiben (dort kann kein Schiff sein) und versenkt gefundene Schiffe." >Stark</label>';
a+='<input type="radio" id="l4" name="l4"><label for="l4" title="Der Computer schummelt und kennt die Schiffe des Gegners.">Extrem</label>';a+="</div>";new_dialog(a,"KI Level");$("#radio").buttonset();$("#radio").tooltip();$("#radio input[type=radio]").click(function(){ki_level="l4"==$(this).attr("name")?4:"l3"==$(this).attr("name")?3:"l2"==$(this).attr("name")?2:1;close_dialog();ki=new KI(schiffe_one,feld,ki_level)});schiffe_one=new Schiffe("Spieler");schiffe_two=new Schiffe("Computer");schiffe_one.place_random();
schiffe_two.place_random();feld.show_field_shoots(schiffe_two.shoots,"shoot_at");feld.show_field_ships(schiffe_one.current,"my_ships");feld.make_shootable("shoot_at",schiffe_two);feld.show_shipnumbers("ship_stat",schiffe_one,schiffe_two);set_message("Die Schiffe wurden gesetzt!");set_message("F\u00fchren Sie den ersten Schuss im Feld rechts aus!!");aktuser=schiffe_one.username}
function game_contra_www(){global_game=!0;new_dialog('Leider ist diese Funktion noch nicht verf\u00fcgbar!<br /><br /><center><div id="button" >OK</div></center>',"Fehler");$("#button").button();$("#button").click(function(){start_game()})}var aktuser;
function pc_shoot_and_refresh(){aktuser=schiffe_two.username;ki.shoot();aktuser=schiffe_one.username;feld.show_field_shoots(schiffe_two.shoots,"shoot_at");feld.show_field_ships(schiffe_one.current,"my_ships");feld.show_shipnumbers("ship_stat",schiffe_one,schiffe_two);show_enemy_field&&(feld.show_field_shoots(schiffe_one.shoots,"shoots"),feld.show_field_ships(schiffe_two.current,"your_ships"))}var show_enemy_field=!1;
function show_enemy(a){"undefined"===typeof a?(a=feld.empty_field("your_ships"),a+=feld.empty_field("shoots"),show_html(a,"div.area_two"),show_enemy_field=!0,feld.show_field_shoots(schiffe_one.shoots,"shoots"),feld.show_field_ships(schiffe_two.current,"your_ships")):(show_html("","div.area_two"),show_enemy_field=!1);return!0}
$(function(){$("div.shoot_at .x").hover(function(){var a=$(this).attr("class").split(/\s+/);2<a.length&&($("div.shoot_at ."+a[1]).css("background-color","#aeb"),$("div.shoot_at ."+a[2]).css("background-color","#aeb"),$("div.shoot_at ."+a[3]).css("background-color","#5d7"))},function(){var a=$(this).attr("class").split(/\s+/);$("div.shoot_at ."+a[1]).css("background-color","white");$("div.shoot_at ."+a[2]).css("background-color","white");$("div.shoot_at ."+a[3]).css("background-color","white")})});
