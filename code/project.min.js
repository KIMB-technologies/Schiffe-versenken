var global_game=!1,global_spielid=0;function randomint(a,b){return Math.floor(Math.random()*(b+1-a)+a)}var message_id=1;function set_message(a){$("div.outputs").prepend('<div id="m'+message_id+'"></div>');3<message_id&&$("div.outputs div#m"+(message_id-3)).css("display","none");$("div.outputs div#m"+message_id).typed({typeSpeed:0,strings:[a]});message_id++;return!0}function show_html(a,b){$(b).html(a);return!0}
function new_dialog(a,b){$("#dialog").attr("title",b);$("#dialog").html(a);$("#dialog").css("display","block");$("#dialog").dialog({width:600});$("#dialog").dialog("option","title",b)}function close_dialog(){$("#dialog").dialog("close");$("#dialog").css("display","none")}
function reload_data(a){console.log(a);"shoot"==a?global_game||aktuser==schiffe_one.username&&pc_shoot_and_refresh():"alle_versenkt"==a?(set_message("Das Spiel ist aus!"),aktuser==schiffe_one.username?new_dialog("Du hast gewonnen!","Herzlichen Gl\u00fcckwunsch"):new_dialog("Dein Gegner hat gewonnen!","Schade"),show_html('<div style="height:334px;"><br /><br /><br /><center><div id="button_new">Neues Spiel</div></center></a></div>',"div.area_one"),$("#button_new").button(),$("#button_new").click(function(){start_game()}),
show_html("","div.area_two")):"versenkt"==a&&(aktuser==schiffe_one.username?set_message("Du hast ein Schiff versenkt! (Gegener hat noch "+schiffe_two.number_of_ships+"/10)"):set_message("Eines deiner Schiff wurde versenkt! (Du hast noch "+schiffe_one.number_of_ships+"/10)"));return!0}
function Feld(){this.max_x=9;this.max_y=11;this.koordtoletter={0:"A",1:"B",2:"C",3:"D",4:"E",5:"F",6:"G",7:"H",8:"I",9:"J",10:"K",11:"L"};this.empty_field=function(a){a='<div class="splf '+a+'"><div class="y">';a+='<div class="x">&nbsp;</div>';for(var b=0;b<=this.max_x;b++)a+='<div class="x x_'+b+'">'+b+"</div>";a+="</div>";for(b=0;b<=this.max_y;b++){a+='<div class="y y_'+b+'">';a+='<div class="x" title="'+b+'">'+this.koordtoletter[b]+"</div>";for(var d=0;d<=this.max_x;d++)a+='<div class="x y_'+b+
" x_"+d+" y_"+b+"x_"+d+'" title="'+d+" | "+this.koordtoletter[b]+" "+b+'">&nbsp;</div>';a+="</div>"}return a+="</div>"};this.show_field_shoots=function(a,b){$.each(a,function(a,c){var f;0==c.art?f="shoot_water":1==c.art?f="shoot_part":2==c.art&&(f="shoot_all");$("."+b+" div.y_"+c.y+"x_"+c.x).html('<span class="shoot '+f+'">&nbsp;</span>')});return!0};this.show_field_ships=function(a,b){var d=!1;$.each(a,function(a,f){var n=f.size;$.each(f.place,function(a,c){for(var f=c.x,g=c.y,e=c.d,k=c.t,h,l,q,
r,m=0;m<n;m++)"h"==e?(h=f+m,l=g):(h=f,l=g+m),q=0==m?"ship_bug":m==n-1?"ship_end":"ship_all",r=0==k[m]?"ship_black":"ship_red",$("."+b+" div.y_"+l+"x_"+h).html('<span class="ship '+q+"_"+e+" "+r+'">&nbsp;</span>');d=!0})});return d};this.make_shootable=function(a,b){$("."+a+" .x").click(function(){var a=$(this).attr("class").split(/\s+/),c=a[1].substr(2),a=a[2].substr(2);b.shoot_ships(a,c)});return!0};this.show_shipnumbers=function(a,b,d){var c;c='<b>Schiffe</b><br /><div id="one"><div class="label"></div></div><div id="two"><div class="label"></div></div>';
show_html(c,"div."+a);$("div."+a+" #one").progressbar({value:b.number_of_ships,max:10});$("div."+a+" #one .label").text("Spieler: "+b.number_of_ships+"/10");$("div."+a+" #two").progressbar({value:d.number_of_ships,max:10});$("div."+a+" #two .label").text("Gegner: "+d.number_of_ships+"/10");return!0}}
function Schiffe(a){"undefined"===typeof a&&(a="Max Muster");this.username=a;this.current=this.all=a={s:{name:"Schlachtschiff",size:5,anzahl:1,place:[]},k:{name:"Kreuzer",size:4,anzahl:2,place:[]},z:{name:"Zerst\u00f6rer",size:3,anzahl:3,place:[]},u:{name:"U-Boote",size:2,anzahl:4,place:[]}};this.number_of_ships=10;this.shoots=[];this.place_random=function(){var a=this.all,d=this,c=new Feld,f=c.max_x,n=c.max_y,p=[];$.each(this.all,function(c,v){var g=v.size,e=v.anzahl;a[c].place=[];for(var k=[],h=
0;h<g;h++)k.push(0);for(var l,q,r,m,t,s,w=0;w<e;w++){l={};1==randomint(0,1)?l.d="h":l.d="v";l.t=k;"h"==l.d?(r=f-g,q=n):(r=f,q=n-g);do for(m=randomint(0,r),t=randomint(0,q),s=[],s.push(m+"-"+t),h=0;h<g;h++)"h"==l.d?s.push(m+h+"-"+t):s.push(m+"-"+(t+h));while(d.all_places_free(s,p));l.x=m;l.y=t;p=p.concat(s);a[c].place.push(l)}});this.current=a;return!0};this.all_places_free=function(a,d){var c=!1;$.each(a,function(a,b){-1!=$.inArray(b,d)&&(c=!0)});return c};this.shoot_ships=function(a,d){var c=0,f=
this;$.each(this.current,function(n,p){var u=p.size;$.each(p.place,function(n,g){var e,k,h=[];if("h"==g.d){if(g.y==d)for(k=0;k<u;k++)if(e=g.x+k,e=e.toString(),e==a){c=1;for(e=0;e<u;e++)e==k?h.push(1):h.push(g.t[e]);g.t=h;-1==$.inArray(0,g.t)&&(c=2);return f.setretval_for_shoot_ships(c,a,d)}}else if(g.x==a)for(k=0;k<u;k++)if(e=g.y+k,e=e.toString(),e==d){c=1;for(e=0;e<u;e++)e==k?h.push(1):h.push(g.t[e]);g.t=h;-1==$.inArray(0,g.t)&&(c=2);return f.setretval_for_shoot_ships(c,a,d)}})});if(0==c)return this.setretval_for_shoot_ships(c,
a,d)};this.setretval_for_shoot_ships=function(a,d,c){this.shoots.push({x:d,y:c,art:a});var f=[];this.number_of_ships=0;var n=this;$.each(this.current,function(a,b){$.each(b.place,function(a,b){-1==$.inArray(0,b.t)?f.push(!1):(f.push(!0),n.number_of_ships++)})});d=-1==$.inArray(!0,f)?!0:!1;reload_data("shoot");2==a&&(reload_data("versenkt"),d&&reload_data("alle_versenkt"));return a}}$(function(){start_game()});var schiffe_one,schiffe_two,feld;
function start_game(){global_game=!1;set_message('Herzlich Willkommen bei "Schiffe-versenken" von KIMB-technologies!');feld=new Feld;var a;a='<br /><span class="untertitel">Meine Schiffe</span><span class="untertitel">Schussfeld</span><br />'+feld.empty_field("my_ships");a+=feld.empty_field("shoot_at");show_html(a,"div.area_one");a=' Willkommen bei "Schiffe-versenken" von KIMB-technologies!<br />Bitte w\u00e4hlen Sie einen Gegner:<br /><br /><div id="radio"> <input type="radio" id="pc" name="pc"><label for="pc" >Computer</label><input type="radio" id="www" name="www" ><label for="www">Anderer Spieler</label></div>';
new_dialog(a,"Spielbeginn");$("#radio").buttonset();$("#radio input[type=radio]").click(function(){"pc"==$(this).attr("name")?game_contra_pc():game_contra_www()})}
function game_contra_pc(){close_dialog();schiffe_one=new Schiffe("Spieler");schiffe_two=new Schiffe("Computer");schiffe_one.place_random();schiffe_two.place_random();feld.show_field_shoots(schiffe_two.shoots,"shoot_at");feld.show_field_ships(schiffe_one.current,"my_ships");feld.make_shootable("shoot_at",schiffe_two);feld.show_shipnumbers("ship_stat",schiffe_one,schiffe_two);set_message("Die Schiffe wurden gesetzt!");set_message("F\u00fchren Sie den ersten Schuss im Feld rechts aus!!");aktuser=schiffe_one.username}
function game_contra_www(){global_game=!0;new_dialog('Leider ist diese Funktion noch nicht verf\u00fcgbar!<br /><br /><center><div id="button" >OK</div></center>',"Fehler");$("#button").button();$("#button").click(function(){start_game()})}var pc_shoots=[],aktuser;
function pc_shoot_and_refresh(){aktuser=schiffe_two.username;var a,b;do a=randomint(0,feld.max_x),b=randomint(0,feld.max_y);while(-1!=$.inArray(a+"-"+b,pc_shoots));schiffe_one.shoot_ships(a,b);pc_shoots.push(a+"-"+b);aktuser=schiffe_one.username;feld.show_field_shoots(schiffe_two.shoots,"shoot_at");feld.show_field_ships(schiffe_one.current,"my_ships");feld.show_shipnumbers("ship_stat",schiffe_one,schiffe_two);show_enemy_field&&(feld.show_field_shoots(schiffe_one.shoots,"shoots"),feld.show_field_ships(schiffe_two.current,
"your_ships"))}var show_enemy_field=!1;function show_enemy(a){"undefined"===typeof a?(a=feld.empty_field("your_ships"),a+=feld.empty_field("shoots"),show_html(a,"div.area_two"),show_enemy_field=!0,feld.show_field_shoots(schiffe_one.shoots,"shoots"),feld.show_field_ships(schiffe_two.current,"your_ships")):(show_html("","div.area_two"),show_enemy_field=!1);return!0}
$(function(){$("div.shoot_at .x").hover(function(){var a=$(this).attr("class").split(/\s+/);2<a.length&&($("div.shoot_at ."+a[1]).css("background-color","#aeb"),$("div.shoot_at ."+a[2]).css("background-color","#aeb"),$("div.shoot_at ."+a[3]).css("background-color","#5d7"))},function(){var a=$(this).attr("class").split(/\s+/);$("div.shoot_at ."+a[1]).css("background-color","white");$("div.shoot_at ."+a[2]).css("background-color","white");$("div.shoot_at ."+a[3]).css("background-color","white")})});
